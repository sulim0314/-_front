<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trip</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="assets/css/place.css" />
  </head>
  <body>
    <!-- ìƒë‹¨ navbar start -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow fixed-top">
      <div class="container">
        <a
          class="navbar-brand text-black fw-bold"
          href="index.html"
          style="
            font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
            font-size: 30px;
          "
        >
          <img src="./assets/img/logo.png" alt="" width="60" />
          Enjoy Trip
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapsibleNavbar"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
          <ul class="navbar-nav me-auto">
            <!-- <li class="nav-item">
                <a class="nav-link" href="#">ê³µì§€ì‚¬í•­</a>
              </li> -->
            <li class="nav-item">
              <a class="nav-link" href="place.html">í•«í”Œì°¾ê¸°ğŸš—</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">ì—¬í–‰ê³„íšğŸˆ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="board.html">ì •ë³´ê³µìœ âœ¨</a>
            </li>
          </ul>
          <!-- ë¡œê·¸ì¸ ì „ -->
          <ul class="navbar-nav mb-2 me-2 mb-lg-0 beforeLogin">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="register.html">íšŒì›ê°€ì… âœğŸ»</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="login.html">ë¡œê·¸ì¸</a>
            </li>
          </ul>
          <!-- ë¡œê·¸ì¸ í›„ -->
          <ul class="navbar-nav mb-2 me-2 mb-lg-0 afterLogin">
            <li class="nav-item after">
              <a class="nav-link" aria-current="page" href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
            </li>
            <li class="nav-item after">
              <a class="nav-link" aria-current="page" href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
            </li>
            <!-- ë§Œì•½ì— ë‚´ê°€ ê´€ë¦¬ìë¼ë©´ -->
            <li class="nav-item dropdown admin">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                ê´€ë¦¬ì
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-bs-toggle="modal"
                    data-bs-target="#pollModal"
                    >íˆ¬í‘œë§Œë“¤ê¸°</a
                  >
                </li>
                <li><a class="dropdown-item" href="#">ì°¨íŠ¸ë³´ê¸°</a></li>
                <li><a class="dropdown-item" href="#">íšŒì›ê´€ë¦¬</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- ìƒë‹¨ navbar end -->
    <div class="info-box">
      <div class="title"><div class="title-div">ì§€ì—­ë³„ í•«í”Œ âœ¨</div></div>
      <!-- ê´€ê´‘ì§€ ê²€ìƒ‰ start -->
      <form class="d-flex my-3" onsubmit="return false;" role="search">
        <div class="drops">
          <select class="form-select" id="sido">
            <option value="">ì‹œë„ì„ íƒ</option>
          </select>
          <select class="form-select" id="gugun">
            <option value="">êµ¬êµ°ì„ íƒ</option>
          </select>

          <div>
            <select class="form-select" id="search-content-id" class="form-select me-2">
              <option value="0" selected>ê´€ê´‘ì§€ ìœ í˜•</option>
              <option value="12">ê´€ê´‘ì§€</option>
              <option value="14">ë¬¸í™”ì‹œì„¤</option>
              <option value="15">ì¶•ì œê³µì—°í–‰ì‚¬</option>
              <option value="25">ì—¬í–‰ì½”ìŠ¤</option>
              <option value="28">ë ˆí¬ì¸ </option>
              <option value="32">ìˆ™ë°•</option>
              <option value="38">ì‡¼í•‘</option>
              <option value="39">ìŒì‹ì </option>
            </select>
          </div>
          <button id="btn-search" class="btn" type="button">ê²€ìƒ‰</button>
        </div>
      </form>
    </div>
    <!-- ============================== -->
    <!-- [ Base URL: apis.data.go.kr/B551011/KorService1 ] -->
    <div class="both">
      <div id="map" style="width: 45%; height: 600px; margin-left: 5%"></div>
      <div class="row table-div">
        <table class="table table-striped" style="display: none">
          <thead>
            <tr>
              <th style="width: 50%">ëŒ€í‘œì´ë¯¸ì§€</th>
              <th>ê´€ê´‘ì§€ëª…</th>
              <th>ì£¼ì†Œ</th>
            </tr>
          </thead>
          <tbody id="trip-list"></tbody>
        </table>
      </div>
    </div>

    <!--------------------------------------------------------------------------->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="./assets/js/loginUser.js"></script>
    <script src="./assets/js/main.js"></script>

    <script
      type="text/javascript"
      src="//dapi.kakao.com/v2/maps/sdk.js?appkey=302f0a5332f0086029f43115ae4621cd"
    ></script>
    <script>
      // ================================================================================

      ///////////////////////// select box ì„¤ì • (ì§€ì—­, ë§¤ë§¤ê¸°ê°„) /////////////////////////
      let date = new Date();

      // ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¬ë©´ ì‹œë„ì •ë³´ ì–»ê¸°.
      sendRequest("sido", "*00000000");

      // https://juso.dev/docs/reg-code-api/
      // let url = "https://grpc-proxy-server-mkvo6j4wsq-du.a.run.app/v1/regcodes";
      // let regcode = "*00000000";
      // ì „êµ­ íŠ¹ë³„/ê´‘ì—­ì‹œ, ë„
      // https://grpc-proxy-server-mkvo6j4wsq-du.a.run.app/v1/regcodes?regcode_pattern=*00000000

      // ì‹œë„ê°€ ë°”ë€Œë©´ êµ¬êµ°ì •ë³´ ì–»ê¸°.
      document.querySelector("#sido").addEventListener("change", function () {
        if (this[this.selectedIndex].value) {
          let regcode = this[this.selectedIndex].value;
          sendRequest("gugun", regcode);
        } else {
          initOption("gugun");
        }
      });

      // êµ¬êµ°ì´ ë°”ë€Œë©´ ë™ì •ë³´ ì–»ê¸°.
      // document.querySelector("#gugun").addEventListener("change", function () {
      //   if (this[this.selectedIndex].value) {
      //     let regcode = this[this.selectedIndex].value.substr(0, 5) + "*";
      //     sendRequest("dong", regcode);
      //   } else {
      //     initOption("dong");
      //   }
      // });

      function sendRequest(selid, regcode) {
        let baseUrl = `https://apis.data.go.kr/B551011/KorService1/`;
        let serviceKey = `ScOkM1ug0yE7uoDK3Ft8mvtZ6YP2%2FLmcZJq7aiocIoIwoD3Jja5Dkx%2FCkAbdzrQQke7fV2%2BeQr5J%2FibWyeAhfw%3D%3D`;
        let queryString = `serviceKey=${serviceKey}&numOfRows=30&MobileOS=ETC&MobileApp=Test&_type=json`;
        if (selid == "sido") {
          let searchUrl = baseUrl + "areaCode1" + "?" + queryString;
          fetch(searchUrl)
            .then((response) => response.json())
            .then((data) => addOption(selid, data));
        } else {
          let searchUrl = baseUrl + "areaCode1" + "?" + queryString + `&areaCode=${regcode}`;
          fetch(searchUrl)
            .then((response) => response.json())
            .then((data) => addOption(selid, data));
        }
      }

      function addOption(selid, data) {
        let opt = ``;
        initOption(selid);
        switch (selid) {
          case "sido":
            opt += `<option value="">ì‹œë„ì„ íƒ</option>`;
            data.response.body.items.item.forEach(function (regcode) {
              opt += `
                <option value="${regcode.code}">${regcode.name}</option>
                `;
            });
            break;
          case "gugun":
            opt += `<option value="">êµ¬êµ°ì„ íƒ</option>`;
            // console.log(data.response.body.items.item);
            data.response.body.items.item.forEach(function (regcode) {
              opt += `
                <option value="${regcode.code}">${regcode.name}</option>
                `;
            });
            break;
        }
        document.querySelector(`#${selid}`).innerHTML = opt;
      }

      function initOption(selid) {
        let options = document.querySelector(`#${selid}`);
        options.length = 0;
      }

      serviceKey = `ScOkM1ug0yE7uoDK3Ft8mvtZ6YP2%2FLmcZJq7aiocIoIwoD3Jja5Dkx%2FCkAbdzrQQke7fV2%2BeQr5J%2FibWyeAhfw%3D%3D`;
      document.getElementById("btn-search").addEventListener("click", () => {
        let baseUrl = `https://apis.data.go.kr/B551011/KorService1/`;

        let queryString = `serviceKey=${serviceKey}&numOfRows=100&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json&listYN=Y&arrange=A`;
        let areaCode = document.querySelector("#sido").selectedIndex;
        let sigungucode = document.querySelector("#gugun").selectedIndex;
        let contentTypeId = document.getElementById("search-content-id").value;

        if (parseInt(areaCode)) queryString += `&areaCode=${areaCode}&sigunguCode=${sigungucode}`;
        if (parseInt(contentTypeId)) queryString += `&contentTypeId=${contentTypeId}`;
        let service = ``;
        service = `areaBasedList1`;
        let searchUrl = baseUrl + service + "?" + queryString;
        fetch(searchUrl)
          .then((response) => response.json())
          .then((data) => makeList(data));
      });
      /////////////////////////////////////////////////
      var positions; // marker ë°°ì—´.
      // ë§ˆì»¤ì™€ ì¸í¬ìœˆë„ìš°ë¥¼ ê´€ë¦¬í•  ë°°ì—´ì„ ìƒì„±í•©ë‹ˆë‹¤.
      var markers = [];
      var infowindows = [];

      function makeList(data) {
        console.log(data);
        document.querySelector("table").setAttribute("style", "display: ;");
        let trips = data.response.body.items.item;
        console.log(trips);
        let tripList = ``;
        positions = [];
        trips.forEach((area) => {
          tripList += `
            <tr onclick="moveCenter(${area.mapy}, ${area.mapx});">
              <td><img src="${area.firstimage}" width="100%" class="rounded"></td>
              <td>${area.title}</td>
              <td>${area.addr1} ${area.addr2}</td>
            </tr>
          `;
          // <td>${area.mapy}</td>  <td>${area.mapx}</td>
          let markerInfo = {
            img: area.firstimage,
            title: area.title,
            latlng: new kakao.maps.LatLng(area.mapy, area.mapx),
            addr: area.addr1 + area.addr2,
          };
          positions.push(markerInfo);
        });
        document.getElementById("trip-list").innerHTML = tripList;
        removeMarker();
        displayMarker();
      }

      // ì¹´ì¹´ì˜¤ì§€ë„ ===============================================================
      var mapContainer = document.getElementById("map"), // ì§€ë„ë¥¼ í‘œì‹œí•  div
        mapOption = {
          center: new kakao.maps.LatLng(37.500613, 127.036431), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
          level: 5, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

      // ì§€ë„ë¥¼ í‘œì‹œí•  divì™€  ì§€ë„ ì˜µì…˜ìœ¼ë¡œ  ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var map = new kakao.maps.Map(mapContainer, mapOption);

      function removeMarker() {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(null); // ë§ˆì»¤ë¥¼ ì§€ë„ì—ì„œ ì œê±°í•©ë‹ˆë‹¤.
        }
        markers = []; // ë°°ì—´ì„ ë¹„ì›ë‹ˆë‹¤.
      }

      function displayMarker() {
        // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ ì£¼ì†Œì…ë‹ˆë‹¤
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < positions.length; i++) {
          // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ í¬ê¸° ì…ë‹ˆë‹¤
          var imageSize = new kakao.maps.Size(24, 35);

          // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
          var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

          marker = null;

          // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
          var marker = new kakao.maps.Marker({
            map: map, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ì§€ë„
            position: positions[i].latlng, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜
            //title: positions[i].title, // ë§ˆì»¤ì˜ íƒ€ì´í‹€, ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ íƒ€ì´í‹€ì´ í‘œì‹œë©ë‹ˆë‹¤
            image: markerImage, // ë§ˆì»¤ ì´ë¯¸ì§€
          });

          // ì¸í¬ìœˆë„ìš° ë‚´ìš© (ì—¬ê¸°ì„œëŠ” ê°„ë‹¨í•œ ë¬¸ìì—´ë¡œ ê°€ì •)
          var infowindowContent =
            '<div class="nemo">' +
            '<div><img src="' +
            positions[i].img +
            '" class="rounded"></div>' +
            '<div class="nemo-title">' +
            positions[i].title +
            "</div>" +
            " " +
            '<div class="nemo-addr">' +
            positions[i].addr +
            "</div></div>";
          // console.log(infowindowContent);
          // ì¸í¬ìœˆë„ìš° ìƒì„±
          var infowindow = new kakao.maps.InfoWindow({
            content: infowindowContent,
          });

          infowindows.push(infowindow);

          // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ ì˜¤ë²„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
          kakao.maps.event.addListener(
            marker,
            "mouseover",
            (function (marker, i) {
              return function () {
                // í•´ë‹¹ ë§ˆì»¤ì— ëŒ€í•œ ì¸í¬ìœˆë„ìš°ë¥¼ ì—½ë‹ˆë‹¤.
                infowindows[i].open(map, marker);
              };
            })(marker, i)
          );

          // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ ì•„ì›ƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (ì„ íƒ ì‚¬í•­)
          kakao.maps.event.addListener(
            marker,
            "mouseout",
            (function (marker, i) {
              return function () {
                // í•´ë‹¹ ë§ˆì»¤ì— ëŒ€í•œ ì¸í¬ìœˆë„ìš°ë¥¼ ë‹«ìŠµë‹ˆë‹¤.
                infowindows[i].close();
              };
            })(marker, i)
          );
        }

        // ì²«ë²ˆì§¸ ê²€ìƒ‰ ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ì§€ë„ ì¤‘ì‹¬ì„ ì´ë™ ì‹œí‚µë‹ˆë‹¤
        map.setCenter(positions[0].latlng);
      }
      function moveCenter(lat, lng) {
        map.setCenter(new kakao.maps.LatLng(lat, lng));
      }

      // ================================================================================

      // ================================================================================
      var container = document.getElementById("map"); //ì§€ë„ë¥¼ ë‹´ì„ ì˜ì—­ì˜ DOM ë ˆí¼ëŸ°ìŠ¤

      // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤
      var position = new kakao.maps.LatLng(33.450701, 126.570667);

      var options = {
        //ì§€ë„ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ê¸°ë³¸ ì˜µì…˜
        center: position, //ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ.
        level: 3, //ì§€ë„ì˜ ë ˆë²¨(í™•ëŒ€, ì¶•ì†Œ ì •ë„)
      };

      var map = new kakao.maps.Map(container, options); //ì§€ë„ ìƒì„± ë° ê°ì²´ ë¦¬í„´

      // ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
      var mapTypeControl = new kakao.maps.MapTypeControl();

      // ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
      // kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
      map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

      // ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
      var zoomControl = new kakao.maps.ZoomControl();
      map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

      var imageSrc = "./assets/img/logo.png", // ë§ˆì»¤ì´ë¯¸ì§€ì˜ ì£¼ì†Œì…ë‹ˆë‹¤
        imageSize = new kakao.maps.Size(64, 69), // ë§ˆì»¤ì´ë¯¸ì§€ì˜ í¬ê¸°ì…ë‹ˆë‹¤
        imageOption = { offset: new kakao.maps.Point(27, 69) }; // ë§ˆì»¤ì´ë¯¸ì§€ì˜ ì˜µì…˜ì…ë‹ˆë‹¤. ë§ˆì»¤ì˜ ì¢Œí‘œì™€ ì¼ì¹˜ì‹œí‚¬ ì´ë¯¸ì§€ ì•ˆì—ì„œì˜ ì¢Œí‘œë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

      // ë§ˆì»¤ì˜ ì´ë¯¸ì§€ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” ë§ˆì»¤ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imageOption),
        markerPosition = new kakao.maps.LatLng(37.54699, 127.09598); // ë§ˆì»¤ê°€ í‘œì‹œë  ìœ„ì¹˜ì…ë‹ˆë‹¤

      // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
      var marker = new kakao.maps.Marker({
        position: position,
        image: markerImage, // ë§ˆì»¤ì´ë¯¸ì§€ ì„¤ì •
      });

      // ë§ˆì»¤ê°€ ì§€ë„ ìœ„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤
      marker.setMap(map);
    </script>
    <!--------------------------------------------------------------------------->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="./assets/js/loginUser.js"></script>
    <script src="./assets/js/main.js"></script>
    <script></script>
  </body>
</html>
